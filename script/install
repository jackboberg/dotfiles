#!/usr/bin/env bash

# script/install: Clone repository and execute setup

set -euo pipefail
IFS=$'\n\t'

REPO="https://github.com/jackboberg/dotfiles.git"
SRC_DIR="${HOME}/src/github.com/jackboberg"
DOT_DIR="${SRC_DIR}/dotfiles"

install () {
    echo "==> script/install…"
    install_xcode
    get_dotfiles
    setup
}

install_xcode () {
    echo "==> Looking for Command Line Tools…"
    xcode-select --print-path >/dev/null 2>&1 || {
        echo "==> Installing Command Line Tools…"
        xcode-select --install
    }
}

get_dotfiles () {
    echo "==> Getting dotfiles…"
    if [ -d "$DOT_DIR" ]; then
        echo "==> $DOT_DIR exists…"
        exit 1
    fi

    mkdir -p $SRC_DIR
    git clone $REPO $DOT_DIR
}

setup () {
    echo "==> Setting up dotfiles…"
    cd $DOT_DIR
    script/setup
}

install "$@"
