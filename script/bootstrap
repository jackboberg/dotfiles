#!/usr/bin/env bash

# script/bootstrap: Resolve all dependencies

set -euo pipefail
IFS=$'\n\t'

bootstrap () {
    cd "$(dirname "$0")/.."
    echo "==> script/bootstrap…"

    bootstrap_xcode
    bootstrap_homebrew
}

bootstrap_xcode () {
    echo "==> Looking for Command Line Tools…"
    xcode-select --print-path >/dev/null 2>&1 || {
        echo "==> Installing Command Line Tools…"
        xcode-select --install
    }
}

bootstrap_homebrew () {
    if ! [ -x "$(command -v brew)" ]; then
        echo "==> Installing Homebrew…"
        /usr/bin/env bash -c \
            "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
    fi
    if [ -f "Brewfile" ] && [ "$(uname -s)" = "Darwin" ]; then
        echo "==> Checking Homebrew dependencies…"
        brew bundle check >/dev/null 2>&1  || {
            echo "==> Installing Homebrew dependencies…"
            brew bundle --no-upgrade
        }
    fi
}

if [[ "${#BASH_SOURCE[@]}" -eq 1 ]]; then
    bootstrap "$@"
fi
